<!DOCTYPE html>
<html>
    <head>
        <%- include("./head.ejs") %>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
        <script src="/js/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="/css/jquery-ui.css">
        <style>
        
          .table{
            width:89vw;
            text-align: center;
            background-color: rgb(173, 185, 202);
          }
          .input-group{
            width: 25vw;
            text-align: center;
            background-color: rgb(173, 185, 202);
          } 
          .wrapper{
            height:30vh;
            width:89vw;
            background-color: rgba(199, 202, 241, 0.308);;
          }
          #instruct_icon{
            background-color: var(--first-color);
          }
          .input-group-text{
            border-radius:0;
            width: 20vw;
          }
          .form-control{
            border-radius: 0;
          }
          #instruct_icon{
              background-color: var(--first-color);
          }
          
        </style>
    </head>

    <body style="background-color: rgb(41, 43, 48); overflow-y:hidden">
      <form action="/instruct" method="POST">
        <div class="wrapper" style="position: absolute; left:8.5vw">
          <div class="input-group mb-3" style="position: absolute; left:14.5vw; top:4vh">
            <span class="input-group-text" id="inputGroup-sizing-default" style="width:10vw">담당자</span>
            <input type="text" class="form-control" placeholder="담당자" id = "manager" name="_manager">
          </div>
          <div class="input-group mb-3" style="position: absolute; left:47.5vw; top:4vh">
            <span class="input-group-text" id="inputGroup-sizing-default" style="width:10vw">지시 수량</span>
            <input type="text" class="form-control" placeholder="지시 수량" id = "quantity" name="_quantity">
          </div>
          <div class="input-group mb-3" style="position: absolute; left:14.5vw; top:13vh">
            <label class="input-group-text" for="inputGroupSelect01" style="width:10vw">품목 번호</label>
            <select class="form-select" id="inputGroupSelect01" name ="_id">
              <option value="bricks_rect">bricks_rect</option>
              <option value="bricks_square">bricks_square</option>
              <option value="circle">circle</option>
              <option value="floor">floor</option>
            </select>
          </div>
          <div class="input-group mb-3" style="position: absolute; left:47.5vw; top:13vh">
            <label class="input-group-text" for="inputGroupSelect01" style="width:10vw">작업 날짜</label>
            <input type="text" id="datepicker" name="_date" value="<%= date %> " style="width: 60.2%;">
          </div>
          <div align="center">
            <button type="submit" class="btn btn-dark" style="position:absolute; bottom: 1vw; right: 14.5vw;" id = "register" disabled>등록</button>
          </div>
          <div align="center">
            <button type="submit" class="btn btn-danger " style="position:absolute; bottom: 1vw; right: 10.5vw;" onclick="del">삭제</button>
          </div>
          
        </div>
        
      </form>

      <!-- //테이블 목록 -->
      <div style="position: absolute; top:36vh; left:8.5vw; color:white; text-align: center;">
        <table class = "table table-bordered" style=" text-align: center; color:white; background-color: rgba(95, 100, 126, 0.699);">
          <thead style="background-color: rgba(199, 202, 241, 0.308); height:4vh;">
            <tr>
              <th scope="col" style="width: 17vw;">작업지시번호</th>
              <th scope="col" style="width: 17vw;">품목명</th>
              <th scope="col" style="width: 10vw;">지시 수량</th>
              <th scope="col" style="width: 25vw;">주문일</th>
              <th scope="col" style="width: 25vw;">납기일</th>
              <th scope="col" style="width: 15vw;">담당자</th>
              <th scope="col" style="width: 15vw;">상태</th>
              <!-- <th scope="col" style="width: 5vw;">비고</th> -->
            </tr>
          </thead>
          <tbody>
            <% for(var i=0; i < ordert.length; i++) {%>
              <tr>
                <td><%=ordert[i].order_id%></td>
                <td><%=ordert[i].lego_id%></td>
                <td><%=ordert[i].quantity%></td>
                <td><%=ordert[i].date%></td>
                <td><%=ordert[i].lastdate%></td>
                <td><%=ordert[i].manager%></td>
                <td>진행중</td>
                
                <!-- <td><button style="height: 5vh;"type="submit" class="btn btn-danger " onclick="del">삭제</button></td> -->
              </tr>
            <%}%>
          </tbody>
        </table>
      </div>
      
      <script>
        //달력
        $('#datepicker').daterangepicker({ 
          "locale": { "format": "YYYY-MM-DD", 
          "separator": " ~ ", 
          "applyLabel": "확인", 
          "cancelLabel": "취소", 
          "fromLabel": "납기일", 
          "toLabel": "주문일", 
          "customRangeLabel": "Custom", 
          "weekLabel": "W", 
          "daysOfWeek": ["일","월", "화", "수", "목", "금", "토"], 
          "monthNames": ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"], 
          "firstDay": 1 }, 
          "startDate": new Date(), 
          "endDate": new Date(), 
          "drops": "dwon" }, 
          
          function (start, end, label) { 
            console.log('New date range selected: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD') + ' (predefined range: ' + label + ')'); 
          }
        );

        $(function(){
          if ("<%=linkcode%>"==0){
              $("#linkcode").text("관리자")
          }else{
              $("#linkcode").text("작업자")
          }
        });

        $("input").keyup(function(){
          var manager = $("#manager").val();
          var quantity = $("#quantity").val();
          var date = $("#datepicker").val();
          var lastdate = $("datepicker").val();
          
          if(manager && quantity && date){    
              $("#register").removeAttr("disabled")
          }else{
              $("#register").attr("disabled", "disabled")
          }
        })

        function del(id){
          if(confirm("삭제 하시겠습니까?")) {
            alert("삭제되었습니다.");
            location.href="/del?_id="+id
          }
        }
      </script>
    </body>
</html>
