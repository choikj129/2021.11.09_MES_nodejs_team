<!DOCTYPE html>
<htm l>

<head>
  <%- include("./head.ejs") %>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script src="/js/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="/css/jquery-ui.css">

    <script src="/js/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="/css/jquery-ui.css">

    <!-- 날짜, 시간 -->
    <!-- <script language="javascript">
    var xmlHttp;
    function srvTime(){
    xmlHttp = new ActiveXObject('Msxml2.XMLHTTP');
    xmlHttp.open('HEAD',window.location.href.toString(),false);
    xmlHttp.setRequestHeader("Content-Type", "text/html");
    xmlHttp.send('');
    return xmlHttp.getResponseHeader("Date");
    }
    var st = srvTime();
    var date = new Date(st);

    alert(date);

    var today = new Date();
    </script> -->

    <!-- <script>
      const NOW_DATE = new Date();
      document.write(NOW_DATE);
      // const NOW_DATE = new Date();
      // document.write(NOW_DATE.getFullYear());
      const NOW_DATE = new Date();
      const NOW_MONTH = NOW_DATE.getMonth() + 1;
      document.write(NOW_MONTH);
      const NOW_DATE = new Date();
      document.write(NOW_DATE.getDate());
    </script> -->
    <!-- let xmlHttp;

if(window.XMLttpRequest){
xmlHttp = new XMLttpRequest();
}
else if (window.ActiveXObject){
xmlHttp = new ActiveXObject('Msxm2.XMLHTTP');
}
else{
return;
}
xmlHttp.open('HEAD', window.location.href.toString(), flase);
xmlHttp.setRequestHeader("Content-Type", "text/html");
xmlHttp.send('');
let serverDate = xmlHttp.getRespeonseHeader("Date")
let currentDateClass = new Date(serverDate);



Imports System.Net
 
Public Class Form1
 
    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
 
        Dim myHttpWebRequest As HttpWebRequest = CType(WebRequest.Create("http://www.interpark.com"), HttpWebRequest)
        Dim myHttpWebResponse As HttpWebResponse = CType(myHttpWebRequest.GetResponse(), HttpWebResponse)
 
        Dim i As Integer
        While i < myHttpWebResponse.Headers.Count
            Console.WriteLine(ControlChars.Cr + "Header Name:{0}, Value :{1}", myHttpWebResponse.Headers.Keys(i), myHttpWebResponse.Headers(i))
            i = i + 1
        End While
 
 
        myHttpWebResponse.Close()
 
        myHttpWebRequest = Nothing
        myHttpWebResponse = Nothing
 
    End Sub
End Class


출처: https://dev.uhoon.co.kr/entry/VBnet-특정-웹서버-시간-읽어오기 [Dev 저장소] -->

    <style>
      .table {
        width: 86vw;
        text-align: center;
        background-color: rgb(173, 185, 202);
      }

      .input-group {
        width: 15.5vw;
        text-align: center;
        background-color: rgb(173, 185, 202);
      }

      .input-group2 {
        width: 18vw;
        text-align: center;
        background-color: rgb(173, 185, 202);
      }

      .wrapper {
        height: 15vh;
        width: 90vw;
        background-color: rgba(199, 202, 241, 0.308);
        ;
      }

      #instruct_icon {
        background-color: var(--first-color);
      }

      .input-group-text {
        border-radius: 0;
        width: 4vw;
      }

      .form-control {
        border-radius: 0;
      }

      #instruct_icon {
        background-color: var(--first-color);
      }

      .modal_wrap {
        display: none;
        width: 34vw;
        height: 60vh;
        /* position: absolute;
        top: 50%;
        left: 50%;
        margin: -250px 0 0 -250px; */
        background: #eee;
        z-index: 2;
      }

      .black_bg {
        display: none;
        position: absolute;
        content: "";
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        top: 0;
        left: 0;
        z-index: 1;
      }

      .modal_close {
        color: white;
        width: 4.5vw;
        height: 6vh;
        position: absolute;
        bottom: 2.5vw;
        right: 8.5vw;
        text-indent: -2.5vw;
      }

      .modal_close>a {
        display: block;
        color: white;
        width: 5vw;
        height: 5vh;
        /* background: url(https://img.icons8.com/metro/26/000000/close-window.png); */
        text-indent: -2.5vw;
      }

      form {
        width: 500px;
      }

      table {
        border-collapse: collapse;
        margin-bottom: 10px;
      }

      th,
      td {
        padding: 3px 10px;
      }

      .off-screen {
        display: none;
      }

      #nav {
        width: 500px;
        text-align: center;
      }

      #nav a {
        display: inline-block;
        padding: 3px 5px;
        margin-right: 10px;
        font-family: Tahoma;
        background: #ccc;
        color: #000;
        text-decoration: none;
      }

      #nav a.active {
        background: #333;
        color: #fff;
      }
    </style>
</head>

<body style="background-color: rgb(41, 43, 48); overflow-y:hidden">
  <form action="/instruct" method="POST">

    <!-- 상단바 -->
    <div class="wrapper" style="position: absolute; left:7.25vw; top:6vh">

      <div style="position: absolute; top:6vh; left:3vw; font-size: large; font-weight: bold; color:white;">수주조회</div>

      <div class="input-group mb-3" style="position: absolute; left:13vw; top:5vh">
        <label class="input-group-text" for="inputGroupSelect01" style="width:6vw">거래처</label>
        <select class="form-select" id="product_i" name="search_i">
          <option value="SAMSUNG">삼성전자</option>
          <option value="LG">LG전자</option>
          <option value="kakao">카카오</option>
          <option value="naver">네이버</option>
        </select>
      </div>

      <div class="input-group mb-3" style="position: absolute; left:30vw; top:5vh">
        <label class="input-group-text" for="inputGroupSelect01" style="width:6vw">품목명</label>
        <select class="form-select" id="product_i" name="search_i">
          <option value="bricks_rect">bricks_rect</option>
          <option value="bricks_square">bricks_square</option>
          <option value="circle">circle</option>
          <option value="floor">floor</option>
        </select>
      </div>

      <div class="input-group mb-3" style="position: absolute; left:47vw; top:5vh">
        <label class="input-group-text" for="inputGroupSelect01" style="width:7vw">수주일자</label>
        <input type="text" class="datepicker wdate" name="_date" value="<%= date %> " style="width:8.5vw;">
      </div>
      <div align="center">
      </div>

      <div class="input-group mb-3" style="position: absolute; left:64vw; top:5vh">
        <label class="input-group-text" for="inputGroupSelect01" style="width:7vw">납기일자</label>
        <input type="text" class="datepicker wdate" name="_date" value="<%= date %> " style="width:8.5vw;">
      </div>
      <div align="center">
      </div>

    </div>
  </form>

  <button class="btn btn-warning" onclick="search()" style="position:absolute; top:10.5vh; right: 5vw;">조회</button>

  <!-- 상단바하단 -->
  <button type="submit" class="btn btn-success modal_btn" style="position:absolute; top:22.5vh; right: 11vw;"
    id="register">등록</button>
  <button class="btn btn-danger " style="position:absolute; top: 22.5vh; right:5vw;" onclick="del()">삭제</button>
  </div>


  <!-- 테이블 목록 -->
  <div style="position: absolute; top:30vh; left:7vw; color:white; text-align: center;">
    <table id="iTable" class="table table-bordered"
      style=" text-align: center; color:white; background-color: rgba(95, 100, 126, 0.699);">
      <thead style="background-color: rgba(199, 202, 241, 0.308); height:4vh;">
        <tr>
          <th scope="col" style="width: 2vw;"><input type="checkbox" id="checkAll" name="_selected_all_"></th>
          <th scope="col" style="width: 8vw;">수주번호</th>
          <th scope="col" style="width: 7vw;">거래처</th>
          <th scope="col" style="width: 10vw;">품목명</th>
          <th scope="col" style="width: 8vw;">주문수량</th>
          <th scope="col" style="width: 10vw;">수주일자</th>
          <th scope="col" style="width: 10vw;">납기일자</th>
          <th scope="col" style="width: 10vw;">생성자</th>
          <th scope="col" style="width: 10vw;">수정자</th>
          <th scope="col" style="width: 10vw;">수정일</th>
        </tr>
      </thead>
      <tbody>
        <% for(var i=0; i < orders.length; i++) {%>
          <tr>
            <td><input type="checkbox" id="del_row" class="chk" name="_selected_" value="<%=orders[i].orders_id%>"></td>
            <td>
              <%=orders[i].orders_id%>
            </td>
            <td>
              <%=orders[i].cust_name%>
            </td>
            <td>
              <%=orders[i].lego_name%>
            </td>
            <td>
              <%=orders[i].orders_qty%>
            </td>
            <td>
              <%=orders[i].orders_date%>
            </td>
            <td>
              <%=orders[i].delivery_date%>
            </td>
            <td>
              <%=orders[i].date_c%>
            </td>
            <td>
              <%=orders[i].mid%>
            </td>
            <td>
              <%=orders[i].date_m%>
            </td>
          </tr>
          <%}%>
      </tbody>
    </table>
  </div>

  <!-- 수정 모달창 -->
  <div class="modal_wrap" style="position: absolute; left:35vw; top:20vh">
    <!-- <div class="modal_close"><a href="#">close</a></div> -->
    <div>
      <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:5vh">
        <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">거래처</span>
        <input type="text" class="form-control" placeholder="거래처" id="manager" name="_manager"
          style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
        <select class="form-select" id="product_i" name="search_i">
          <option value="SAMSUNG">삼성전자</option>
          <option value="LG">LG전자</option>
          <option value="kakao">카카오</option>
          <option value="naver">네이버</option>
        </select>
      </div>
      <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:13vh">
        <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">품목ID</span>
        <input type="text" class="form-control" placeholder="품목ID" id="quantity" name="_quantity"
          style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
        <select class="form-select" id="product_i" name="search_i">
          <option value="bricks_rect">bricks_rect</option>
          <option value="bricks_square">bricks_square</option>
          <option value="circle">circle</option>
          <option value="floor">floor</option>
        </select>
      </div>
      <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:21vh">
        <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">주문수량</span>
        <input type="text" class="form-control" placeholder="주문수량" id="manager" name="_manager"
          style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
      </div>
      <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:29vh">
        <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">수주일자</span>
        <input type="text" class="datepicker" name="_date"
          style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
        <!-- <input type="text" class="form-control" placeholder="수주일자" id = "manager" name="_manager"> -->
      </div>
      <div class="input-group mb-3" style="position:absolute; width:10vw; left:6.5vw; top:37vh">
        <label class="input-group-text" for="inputGroupSelect01" style="width:8vw">납기일자</label>
        <input type="text" class="datepicker" name="_date"
          style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
      </div>
      <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:45vh">
        <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">생성자</span>
        <input type="text" class="form-control" placeholder="생성자" id="manager" name="_manager"
          style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
      </div>
    </div>
    <!-- <div class="input-group mb-3" style="position: absolute; left:5.5vw; top:20vh">
        <label class="input-group-text" for="inputGroupSelect01" style="width:10vw">생성자</label>
        <select class="form-select" id="inputGroupSelect01" name ="_id">
          <option value="bricks_rect">bricks_rect</option>
          <option value="bricks_square">bricks_square</option>
          <option value="circle">circle</option>
          <option value="floor">floor</option>
        </select>
      </div> -->
    <div align="center">
      <button type="submit" class="btn btn-secondary" style="position:absolute; bottom: 2.5vw; right: 19vw;"
        id="register">등록</button>
      <button type="submit" class="modal_close btn btn-secondary"
        style="position:absolute; bottom: 2.5vw; right: 8.5vw;" id="register"><a href="#">취소</a></button>
    </div>
  </div>
  </div>
  <button type='button' class="btn btn-secondary modal_btn btn-sm"
    style="position:absolute; top: 37.5vh; right:2vw;">수정</button>
  <button type='button' class="btn btn-secondary modal_btn btn-sm"
    style="position:absolute; top: 44.5vh; right:2vw;">수정</button>
  <button type='button' class="btn btn-secondary modal_btn btn-sm"
    style="position:absolute; top: 51.5vh; right:2vw;">수정</button>

  <!---- 등록모달창 ---->
  <div class="modal_wrap" style="position: absolute; left:35vw; top:20vh">
    <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:5vh">
      <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">거래처</span>
      <input type="text" class="form-control" placeholder="거래처" id="manager" name="_manager"
        style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
      <select class="form-select" id="product_i" name="search_i">
        <option value="SAMSUNG">삼성전자</option>
        <option value="LG">LG전자</option>
        <option value="kakao">카카오</option>
        <option value="naver">네이버</option>
      </select>
    </div>
    <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:13vh">
      <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">품목ID</span>
      <input type="text" class="form-control" placeholder="품목ID" id="quantity" name="_quantity"
        style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
      <select class="form-select" id="product_i" name="search_i">
        <option value="bricks_rect">bricks_rect</option>
        <option value="bricks_square">bricks_square</option>
        <option value="circle">circle</option>
        <option value="floor">floor</option>
      </select>
    </div>
    <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:21vh">
      <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">주문수량</span>
      <input type="text" class="form-control" placeholder="주문수량" id="manager" name="_manager"
        style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
    </div>
    <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:29vh">
      <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">수주일자</span>
      <input type="text" class="datepicker" name="_date"
        style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
      <!-- <input type="text" class="form-control" placeholder="수주일자" id = "manager" name="_manager"> -->
    </div>
    <div class="input-group mb-3" style="position:absolute; width:10vw; left:6.5vw; top:37vh">
      <label class="input-group-text" for="inputGroupSelect01" style="width:8vw">납기일자</label>
      <input type="text" class="datepicker" name="_date"
        style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
    </div>
    <div class="input-group mb-3" style="position:absolute; width:20vw; left:6.5vw; top:45vh">
      <span class="input-group-text" id="inputGroup-sizing-default" style="width:8vw">생성자</span>
      <input type="text" class="form-control" placeholder="생성자" id="manager" name="_manager"
        style="position: absolute; width: 12vw; height:6vh; left:8vw; top:0.2vh">
    </div>
    <!-- <div class="input-group mb-3" style="position: absolute; left:5.5vw; top:20vh">
        <label class="input-group-text" for="inputGroupSelect01" style="width:10vw">생성자</label>
        <select class="form-select" id="inputGroupSelect01" name ="_id">
          <option value="bricks_rect">bricks_rect</option>
          <option value="bricks_square">bricks_square</option>
          <option value="circle">circle</option>
          <option value="floor">floor</option>
        </select>
      </div> -->
    <div align="center">
      <button type="submit" class="btn btn-secondary" style="position:absolute; bottom: 2.5vw; right: 19vw;"
        id="register">등록</button>
      <button type="submit" class="modal_close btn btn-secondary" style="position:absolute; bottom: 2.5vw; right: 8vw;"
        id="register"><a href="#">취소</a></button>
    </div>
  </div>


  <!-- 페이지 넘김 숫자 -->
  <div id="nav" style="position:absolute; top:90vh; left:35vw;">
    <a href="#" rel="0" class="active">1</a>
    <a href="#" rel="1">2</a>
    <a href="#" rel="2">3</a>
    <a href="#" rel="3">4</a>
  </div>
  <script src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-1b93190,,,.js"></script>
  <script src="https:// cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <script id="rendered-js">
    var $setRows = $('#setRows');
    $setRows.submit(function (e) {
      e.preventDefault();
      var rowPerPage = $('[name="rowPerPage"]').val() * 1;// 1 을  곱하여 문자열을 숫자형로 변환
      //		console.log(typeof rowPerPage);
      var zeroWarning = 'Sorry, but we cat\'t display "0" rows page. + \nPlease try again.'
      if (!rowPerPage) {
        alert(zeroWarning);
        return;
      }
      $('#nav').remove();
      var $products = $('#products');
      $products.after('<div id="nav">');
      var $tr = $($products).find('tbody tr');
      var rowTotals = $tr.length;
      //	console.log(rowTotals);
      var pageTotal = Math.ceil(rowTotals / rowPerPage);
      var i = 0;
      for (; i < pageTotal; i++) {
        $('<a href="#"></a>')
          .attr('rel', i)
          .html(i + 1)
          .appendTo('#nav');
      }
      $tr.addClass('off-screen')
        .slice(0, rowPerPage)
        .removeClass('off-screen');
      var $pagingLink = $('#nav a');
      $pagingLink.on('click', function (evt) {
        evt.preventDefault();
        var $this = $(this);
        if ($this.hasClass('active')) {
          return;
        }
        $pagingLink.removeClass('active');
        $this.addClass('active');
        // 0 => 0(0*4), 4(0*4+4)
        // 1 => 4(1*4), 8(1*4+4)
        // 2 => 8(2*4), 12(2*4+4)
        // 시작 행 = 페이지 번호 * 페이지당 행수
        // 끝 행 = 시작 행 + 페이지당 행수
        var currPage = $this.attr('rel');
        var startItem = currPage * rowPerPage;
        var endItem = startItem + rowPerPage;
        $tr.css('opacity', '0.0')
          .addClass('off-screen')
          .slice(startItem, endItem)
          .removeClass('off-screen')
          .animate({ opacity: 1 }, 300);
      });
      $pagingLink.filter(':first').addClass('active');
    });
    $setRows.submit();
  </script>






  <!-- 검색 조회 결과 테이블 -->
  <!-- <div style="position: absolute; top:70vh; left:6vw; color:white; text-align: center;">
<table id="iTable2" class = "table table-bordered" style=" text-align: center; color:white; background-color: rgba(95, 100, 126, 0.699);">
<thead style="background-color: rgba(199, 202, 241, 0.308); height:4vh;">
<tr>
<th scope="col" style="width: 17vw;">작업지시번호</th>
<th scope="col" style="width: 17vw;">품목명</th>
<th scope="col" style="width: 10vw;">지시 수량</th>
<th scope="col" style="width: 25vw;">주문일</th>
<th scope="col" style="width: 15vw;">담당자</th>
<th scope="col" style="width: 15vw;">상태</th>
</tr>
</thead>
<tbody id="tbody2">
<% for(var i=0; i < orders.length; i++) {%>
<tr>
<td><%=orders[i].order_id%></td>
<td><%=orders[i].lego_id%></td>
<td><%=orders[i].quantity%></td>
<td><%=orders[i].date%></td>
<td><%=orders[i].manager%></td>
<td>진행중</td>
</tr>
<%}%>
</tbody>
</table>
</div> -->




  <script>
    $(function () {
      if ("<%=linkcode%>" == 0) {
        $("#linkcode").text("관리자")
      } else {
        $("#linkcode").text("작업자")
      }
    });

    $("input").keyup(function () {
      var manager = $("#manager").val();
      var quantity = $("#quantity").val();
      var date = $(".wdate").val();


      if (manager && quantity && date) {
        $("#register").removeAttr("disabled")
      } else {
        $("#register").attr("disabled", "disabled")
      }
    })

    // 작업지시 삭제
    function del() {
      var checkBoxArr = [];
      $("input:checkbox[name='_selected_']:checked").each(function () {
        checkBoxArr.push($(this).val()); //체크된 값 뽑아서 push
      })
      if (confirm("삭제 하시겠습니까?")) {
        alert("삭제되었습니다.");
        location.href = "/orderS_del?_id=" + checkBoxArr
      }
    }

    // 전체선택 버튼 클릭시 체크박스 전체 선택
    $("#checkAll").click(function () {
      if ($("#checkAll").is(":checked")) {
        $(".chk").prop("checked", true);
      } else {
        $(".chk").prop("checked", false);
      }
    })
    // 전체선택 중 한개의 체크박스 선택 해제 시 체크박스 해제
    $(".chk").click(function () {
      if ($("input[name='_selected_']:checked").length == iTable.rows.length) {
        $("#checkAll").prop("checked", true);
      } else {
        $("#checkAll").prop("checked", false);
      }
    });

    function search() {
      $("#tbody2").html("");
      var pd = $("#product_i").val()
      $.getJSON("/instruct_search", {
        pd: pd
      },
        function (result) {
          var body;
          for (var i = 0; i < result.instruct.length; i++) {
            body += "<tr>"
            for (key in result.instruct[0]) {
              body += "<td>" + result.instruct[i][key] + "</td>"
            }
            body += "</tr>"
          }
          $("#tbody2").html(body)
        })
    }

    // 모달
    $(".modal_btn").click(function () {
      $(".modal_wrap").css("display", "block")
      $(".black_bg").css("display", "block")
    })

    $(".modal_close").click(function () {
      $(".modal_wrap").css("display", "none")
      $(".black_bg").css("display", "none")
    })

    //달력(날짜 1개 선택)
    $(".datepicker").datepicker({
      dateFormat: "yy-mm-dd",
      monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
      monthNamesShort: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
      dayNamesMin: ['월', '화', '수', '목', '금', '토', '일'],
      changeMonth: true,
      changeYear: true,
      nextText: '다음달',
      prevText: '이전달',
      showOtherMonths: true,
      selectOtherMonths: true,
      changeMonth: true,
      changeYear: true
    });
    $('.datepicker').datepicker('setDate', 'today');

    function search() {
      $("tbody").html("");
      var date = $(".datepicker").val()
      $.getJSON("/defect_search", {
        date: date
      },
        function (result) {
          var body;
          for (var i = 1; i < result.defect.length; i++) {
            body += "<tr>"
            for (key in result.defect[0]) {
              body += "<td>" + result.defect[i][key] + "</td>"
            }
            body += "</tr>"
          }
          $("tbody").html(body)
        })
    }


  </script>
</body>

</html>