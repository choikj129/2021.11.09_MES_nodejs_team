<!DOCTYPE html>
<html>
    <head>
        <%- include("./head.ejs") %>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
        <script src="/js/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="/css/jquery-ui.css">
        <style>
            .table{
                width:92.5vw;
                text-align: center;
                background-color: rgb(173, 185, 202);
            }
            .wrapper{
                height:10vh;
                width:92.5vw;
                background-color: rgba(199, 202, 241, 0.308);
            }
            .input-group{
                width: 25vw;
                text-align: center;
                background-color: rgb(173, 185, 202);
            } 
        </style>
    </head>
    <body style="background-color: rgb(41, 43, 48); overflow-y:hidden">
        <div style="position: absolute; top:6.5vh; left:8vw; font-size: large; font-weight: bold; color:white;">작업실적조회</div>
        <div class="wrapper" style="position: absolute; top:3vh; left:6vw">

            <div class="input-group mb-3" style="position: absolute; left:15vw; top:3vh">
                <label class="input-group-text" for="inputGroupSelect01" style="width:10vw">품목명</label>
                <select class="form-select" id="product_i" name="search_i">
                    <option value=""></option>
                    <option value="bricks_rect">bricks_rect</option>
                    <option value="bricks_square">bricks_square</option>
                    <option value="circle">circle</option>
                    <option value="floor">floor</option>
                </select>
            </div>
            <div class="input-group mb-3" style="position: absolute; left:45vw; top:3vh">
                <label class="input-group-text" for="inputGroupSelect01" style="width:10vw">작업 날짜</label>
                <input type="text" class="datepicker wdate" id="product_d" name="_date" style="width: 60.2%;">
            </div>
            <button class="btn btn-secondary" onclick="search()" style="position:absolute; bottom:3vh; right:10vw">조회</button>
            <button class="btn btn-light" onclick="reset()" style="position:absolute; bottom:3vh; right:2vw">검색 초기화</button>
        </div>

        <div style="position: absolute; top:15vh; left:6vw; color:white; text-align: center;">
            <table class = "table table-bordered" style=" text-align: center; color:white; background-color: rgba(95, 100, 126, 0.699);">
                <thead style="background-color: rgba(199, 202, 241, 0.308); height:4vh;">
                    <tr>
                        <th scope="col" style="width: 12vw;">작업지시번호</th>
                        <th scope="col" style="width: 17.5vw;">작업일</th>
                        <th scope="col" style="width: 13vw;">품목명</th>
                        <th scope="col" style="width: 13vw;">생산수량</th>
                        <th scope="col" style="width: 12vw;">양품수량</th>
                        <th scope="col" style="width: 12vw;">불량품수량</th>
                        <th scope="col" style="width: 13vw;">담당자</th>
                    </tr>                    
                </thead>
                <tbody id="tbody2">
                    <% for(var i=0; i < performance.length; i++) {%>
                        <tr>
                          <td><%=performance[i].order_id%></td>
                          <td><%=performance[i].date%></td>
                          <td><%=performance[i].lego_name%></td>
                          <td><%=performance[i].quantity%></td>
                          <td><%=performance[i].qty_good%></td>
                          <td><%=performance[i].qty_def%></td>
                          <td><%=performance[i].manager%></td>
                        </tr>
                    <%}%>
                  </tbody>
            </table>
        </div>

        <script>
            //달력
            $("input").keyup(function(){
                var manager = $("#manager").val();
                var quantity = $("#quantity").val();
                var date = $(".wdate").val();
                
                
                if(manager && quantity && date){    
                    $("#register").removeAttr("disabled")
                }else{
                    $("#register").attr("disabled", "disabled")
                }
            })
            $(".datepicker").datepicker({
                dateFormat : "yy-mm-dd",
                monthNames : ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
                monthNamesShort : ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
                dayNamesMin : ['월','화','수','목','금','토','일'],
                changeMonth : true,
                changeYear : true,
                nextText : '다음달',
                prevText : '이전달',
                showOtherMonths: true,
                selectOtherMonths: true,
                changeMonth: true,
                changeYear: true
            });
            //조회
            // function search() {
            //     $("tbody").html("");
            //     var date = $(".datepicker").val()
            //     $.getJSON("/defect_search", {
            //         date: date
            //     },
            //     function (result) {
            //     var body;
            //     for (var i=1; i<result.defect.length; i++){
            //         body += "<tr>"
            //         for (key in result.defect[0]){
            //         body += "<td>"+result.defect[i][key]+"</td>"
            //         }
            //         body += "</tr>"
            //     }
            //     $("tbody").html(body)
            //     })
            // }

            function search(){
                $("#tbody2").html("");
                // var pp = $("#product_i").val()
                // var pd = $("#product_d").val()
                $.getJSON("/product/search", {
                    product_i : $("#product_i").val(),
                    product_d : $("#product_d").val()
                },
                function(result){
                    var body;
                    for(var i=0; i<result.performance.length; i++){
                        body += "<tr>"
                        for (key in result.performance[0]){
                            if(key=="pp_id"){
                                continue
                            }
                            body += "<td>"+result.performance[i][key]+"</td>"
                            
                        }
                        body += "</tr>"
                    }
                    $("#tbody2").html(body)
                })
            }

        function reset(){
            $("#tbody2").html("")
            $("#product_d").val("")
            $("#product_i option:eq(0)").prop("selected", true)
            $.getJSON("/product/reset",
            function(result){ 
              var body;
              for(var i=0; i<result.performance.length; i++){
                body += "<tr>"
                  for (key in result.performance[0]){
                    if(key=="pp_id"){
                            continue
                    }
                    body += "<td>"+result.performance[i][key]+"</td>"
                  }
                body += "</tr>"
              }
              $("#tbody2").html(body)
            }
            )
        }
        </script>
    </body>
</html>